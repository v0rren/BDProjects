DROP TABLE IF EXISTS review
OK
Time taken: 9.853 seconds

CREATE TABLE review (id int, productid string, userid string, profilename string, hnum int, hden int, score int, zaman bigint, summ string, metin string) row format delimited fields terminated by ','
OK
Time taken: 0.476 seconds


LOAD DATA LOCAL INPATH '/home/beyza/Downloads/Reviews.csv' OVERWRITE INTO TABLE review
Loading data to table default.review
OK
Time taken: 1.864 seconds


DROP TABLE IF EXISTS year_sum;
OK
Time taken: 0.855 seconds

CREATE TABLE year_sum (yil int, summ string) row format delimited fields terminated by ',' COLLECTION ITEMS TERMINATED BY ' '
OK
Time taken: 0.784 seconds
 
INSERT INTO year_sum  
SELECT year(from_unixtime(zaman)) AS yil, lower(trim(regexp_replace(summ, '[\'_|$#<>\\^=\\[\\]\\*/\\\\,;,.\\-:()?!\"]', " "))) 
FROM review
WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.
Query ID = beyza_20220513070008_8hr57j0-9fk0-6096-94a3-62kso09nb20
Total jobs = 3
Launching Job 1 out of 3
Number of reduce tasks is set to 0 since there's no reduce operator
Job running in-process (local Hadoop)
2022-05-13 07:00:14,146 Stage-1 map = 0%,  reduce = 0%
2022-05-13 07:00:23,158 Stage-1 map = 100%,  reduce = 0%
Ended Job = job_local739503285_0001
Stage-4 is filtered out by condition resolver.
Stage-3 is selected by condition resolver.
Stage-5 is filtered out by condition resolver.
Launching Job 3 out of 3
Number of reduce tasks is set to 0 since there's no reduce operator
Job running in-process (local Hadoop)
2022-05-13 07:00:25,645 Stage-3 map = 0%,  reduce = 0%
2022-05-13 07:00:27,679 Stage-3 map = 100%,  reduce = 0%
Ended Job = job_local843675093_0002
Loading data to table default.year_sum
MapReduce Jobs Launched: 
Stage-Stage-1:  HDFS Read: 749503846 HDFS Write: 535636932 SUCCESS
Stage-Stage-3:  HDFS Read: 836493024 HDFS Write: 648592045 SUCCESS
Total MapReduce CPU Time Spent: 0 msec
OK
Time taken: 14.759 seconds


DROP TABLE IF EXISTS result
OK
Time taken: 0.567 seconds

CREATE TABLE result (yil int, word string, occ int) row format delimited fields terminated by ','
OK
Time taken: 0.189 seconds

INSERT OVERWRITE TABLE result 
SELECT yil, word, COUNT(*) as count 
FROM year_sum LATERAL VIEW explode(split(summ, ' +')) lTable as word
WHERE yil>=1999 
GROUP BY yil,word 
ORDER BY count DESC, word ASC
WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.
Query ID = beyza_20220513070028_kt9e04mf-5g9e-6jf9-6m4f-go4960cj39f
Total jobs = 2
Launching Job 1 out of 2
Number of reduce tasks not specified. Estimated from input data size: 1
In order to change the average load for a reducer (in bytes):
  set hive.exec.reducers.bytes.per.reducer=<number>
In order to limit the maximum number of reducers:
  set hive.exec.reducers.max=<number>
In order to set a constant number of reducers:
  set mapreduce.job.reduces=<number>
Job running in-process (local Hadoop)
2022-05-13 07:00:30,187 Stage-1 map = 0%,  reduce = 0%
2022-05-13 07:00:38,567 Stage-1 map = 100%,  reduce = 0%
2022-05-13 07:00:41,596 Stage-1 map = 100%,  reduce = 100%
Ended Job = job_local8372654852_0003
Launching Job 2 out of 2
Number of reduce tasks determined at compile time: 1
In order to change the average load for a reducer (in bytes):
  set hive.exec.reducers.bytes.per.reducer=<number>
In order to limit the maximum number of reducers:
  set hive.exec.reducers.max=<number>
In order to set a constant number of reducers:
  set mapreduce.job.reduces=<number>
Job running in-process (local Hadoop)
2022-05-13 07:00:43,382 Stage-2 map = 0%,  reduce = 0%
2022-05-13 07:00:43,389 Stage-2 map = 100%,  reduce = 0%
2022-05-13 07:00:45,403 Stage-2 map = 100%,  reduce = 100%
Ended Job = job_local4767549975_0004
Loading data to table default.result
MapReduce Jobs Launched: 
Stage-Stage-1:  HDFS Read: 662282180 HDFS Write: 662265796 SUCCESS
Stage-Stage-2:  HDFS Read: 662282180 HDFS Write: 663424521 SUCCESS
Total MapReduce CPU Time Spent: 0 msec
OK
Time taken: 15.465 seconds


DROP TABLE IF EXISTS rank_result
OK
Time taken: 0.143 seconds

CREATE TABLE rank_result as (
    SELECT yil, word, occ, row_number() over (partition by yil order by occ desc) as rnk
    FROM result
)
WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.
Query ID = beyza_20220512130044_e58233bb-bf09-4532-84d5-e34cfdf5a77e
Total jobs = 1
Launching Job 1 out of 1
Number of reduce tasks not specified. Estimated from input data size: 1
In order to change the average load for a reducer (in bytes):
  set hive.exec.reducers.bytes.per.reducer=<number>
In order to limit the maximum number of reducers:
  set hive.exec.reducers.max=<number>
In order to set a constant number of reducers:
  set mapreduce.job.reduces=<number>
Job running in-process (local Hadoop)
2022-05-13 07:00:48,030 Stage-1 map = 100%,  reduce = 0%
2022-05-13 07:00:49,035 Stage-1 map = 100%,  reduce = 100%
Ended Job = job_local1151317515_0005
Moving data to directory hdfs://localhost:9000/user/hive/warehouse/rank_result
MapReduce Jobs Launched: 
Stage-Stage-1:  HDFS Read: 664599630 HDFS Write: 666141472 SUCCESS
Total MapReduce CPU Time Spent: 0 msec
OK
Time taken: 1.576 seconds


INSERT OVERWRITE LOCAL DIRECTORY '/home/beyza/Downloads/bigdata/hive/hive_logs'
SELECT yil, collect_set(concat_ws(" ",word, cast(occ as string))) 
FROM rank_result 
WHERE rnk<=10 
GROUP BY yil
WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.
Query ID = beyza_8435yr34hf3jf4_r4f38n3g-49rf-4954-f593-gt45g54j954g
Total jobs = 1
Launching Job 1 out of 1
Number of reduce tasks not specified. Estimated from input data size: 1
In order to change the average load for a reducer (in bytes):
  set hive.exec.reducers.bytes.per.reducer=<number>
In order to limit the maximum number of reducers:
  set hive.exec.reducers.max=<number>
In order to set a constant number of reducers:
  set mapreduce.job.reduces=<number>
Job running in-process (local Hadoop)
2022-05-13 07:00:51,178 Stage-1 map = 100%,  reduce = 100%
Ended Job = job_local2141028044_0006
Moving data to local directory /home/beyza/Downloads/bigdata/hive/hive_logs
MapReduce Jobs Launched: 
Stage-Stage-1:  HDFS Read: 435466673 HDFS Write: 465384847 SUCCESS
Total MapReduce CPU Time Spent: 0 msec
OK
Time taken: 1.670 seconds