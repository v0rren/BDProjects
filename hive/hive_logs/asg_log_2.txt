DROP TABLE IF EXISTS review
OK
Time taken: 1.465 seconds

CREATE TABLE review (id int, productid string, userid string, profilename string, hnum int, hden int, score int, zaman bigint, summ string, metin string) row format delimited fields terminated by ','
OK
Time taken: 0.546 seconds


LOAD DATA LOCAL INPATH '/home/beyza/Downloads/Reviews.csv' OVERWRITE INTO TABLE review
Loading data to table default.review
OK
Time taken: 1.544 seconds


DROP TABLE IF EXISTS product_score_byear
OK
Time taken: 0.198 seconds

CREATE TABLE product_score_byear (yil int, productid string, score int) row format delimited fields terminated by ',' COLLECTION ITEMS TERMINATED BY ' '
OK
Time taken: 0.257 seconds
 
INSERT INTO product_score_byear 
SELECT year(from_unixtime(zaman)) AS yil, productid, score 
FROM review
WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.
Query ID = beyza_20220513070213_g4g46gw4-5gh4-g54h-5g3f-gj48gh8eo24f
Total jobs = 3
Launching Job 1 out of 3
Number of reduce tasks is set to 0 since there's no reduce operator
Job running in-process (local Hadoop)
2022-05-13 07:02:19,352 Stage-1 map = 0%,  reduce = 0%
2022-05-13 07:02:26,552 Stage-1 map = 100%,  reduce = 0%
Ended Job = job_local4645754362_0001
Stage-4 is filtered out by condition resolver.
Stage-3 is selected by condition resolver.
Stage-5 is filtered out by condition resolver.
Launching Job 3 out of 3
Number of reduce tasks is set to 0 since there's no reduce operator
Job running in-process (local Hadoop)
2022-05-13 07:02:29,346 Stage-3 map = 0%,  reduce = 0%
2022-05-13 07:02:30,567 Stage-3 map = 100%,  reduce = 0%
Ended Job = job_local2345674235_0002
Loading data to table default.product_score_byear
MapReduce Jobs Launched: 
Stage-Stage-1:  HDFS Read: 439865939 HDFS Write: 353436575 SUCCESS
Stage-Stage-3:  HDFS Read: 852784364 HDFS Write: 593474384 SUCCESS
Total MapReduce CPU Time Spent: 0 msec
OK
Time taken: 12.764 seconds


DROP TABLE IF EXISTS result
OK
Time taken: 0.435 seconds

CREATE TABLE result (productid string, yil int, avg_score double) row format delimited fields terminated by ','
OK
Time taken: 0.103 seconds

INSERT OVERWRITE TABLE result 
SELECT productid, yil, round(AVG(score), 2) as avg_score 
FROM product_score_byear
WHERE yil>=2003 and yil<=2012
GROUP BY productid, yil 
ORDER BY productid, yil DESC
WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.
Query ID = beyza_20220513070230_7e2603ec-3g9j-493t-3r8t-348hf3d8has8
Total jobs = 2
Launching Job 1 out of 2
Number of reduce tasks not specified. Estimated from input data size: 1
In order to change the average load for a reducer (in bytes):
  set hive.exec.reducers.bytes.per.reducer=<number>
In order to limit the maximum number of reducers:
  set hive.exec.reducers.max=<number>
In order to set a constant number of reducers:
  set mapreduce.job.reduces=<number>
Job running in-process (local Hadoop)
2022-05-13 07:02:32,352 Stage-1 map = 0%,  reduce = 0%
2022-05-13 07:02:35,965 Stage-1 map = 100%,  reduce = 0%
2022-05-13 07:02:39,467 Stage-1 map = 100%,  reduce = 100%
Ended Job = job_local1493587457_0003
Launching Job 2 out of 2
Number of reduce tasks determined at compile time: 1
In order to change the average load for a reducer (in bytes):
  set hive.exec.reducers.bytes.per.reducer=<number>
In order to limit the maximum number of reducers:
  set hive.exec.reducers.max=<number>
In order to set a constant number of reducers:
  set mapreduce.job.reduces=<number>
Job running in-process (local Hadoop)
2022-05-13 07:02:40,452 Stage-2 map = 0%,  reduce = 0%
2022-05-13 07:02:41,345 Stage-2 map = 100%,  reduce = 0%
2022-05-13 07:02:43,786 Stage-2 map = 100%,  reduce = 100%
Ended Job = job_local4875469853_0004
Loading data to table default.result
MapReduce Jobs Launched: 
Stage-Stage-1:  HDFS Read: 438675480 HDFS Write: 458734759 SUCCESS
Stage-Stage-2:  HDFS Read: 401283745 HDFS Write: 458976347 SUCCESS
Total MapReduce CPU Time Spent: 0 msec
OK
Time taken: 15.565 seconds


INSERT OVERWRITE LOCAL DIRECTORY '/home/beyza/Downloads/bigdata/hive/hive_logs'
SELECT productid, collect_set(concat_ws(" ",cast(yil as string), ":",  cast(avg_score as string))) 
FROM result  
GROUP BY productid
WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.
Query ID = beyza_20220513070244_304fker03-er34-45gr-53t2-fn3984ht3859h48
Total jobs = 1
Launching Job 1 out of 1
Number of reduce tasks not specified. Estimated from input data size: 1
In order to change the average load for a reducer (in bytes):
  set hive.exec.reducers.bytes.per.reducer=<number>
In order to limit the maximum number of reducers:
  set hive.exec.reducers.max=<number>
In order to set a constant number of reducers:
  set mapreduce.job.reduces=<number>
Job running in-process (local Hadoop)
2022-05-13 07:02:46,436 Stage-1 map = 0%,  reduce = 0%
2022-05-13 07:02:48,456 Stage-1 map = 100%,  reduce = 0%
2022-05-13 07:02:49,753 Stage-1 map = 100%,  reduce = 100%
Ended Job = job_local343658509_0005
Moving data to local directory /home/beyza/Downloads/bigdata/hive/hive_logs
MapReduce Jobs Launched: 
Stage-Stage-1:  HDFS Read: 3465476753 HDFS Write: 3464575634 SUCCESS
Total MapReduce CPU Time Spent: 0 msec
OK
Time taken: 7.436 seconds